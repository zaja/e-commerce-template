<!-- 
  Starter Flavor - Header Template
  Supports: Logo, Navigation Menu, Search, Cart, Account
  Integrates with: Menu system (HEADER location)
-->

<header class="sf-header" id="site-header">
  <div class="sf-container">
    <div class="sf-header-inner">
      <!-- Logo -->
      <a href="/" class="sf-header-logo">
        {{#if workspace.logo}}
          <img src="{{workspace.logo}}" alt="{{workspace.name}}" class="sf-header-logo-img">
        {{else}}
          <span class="sf-header-logo-text">{{workspace.name}}</span>
        {{/if}}
      </a>

      <!-- Desktop Navigation - 3 levels supported -->
      <nav class="sf-header-nav" aria-label="Glavna navigacija">
        {{#if headerMenu}}
          <ul class="sf-nav-list">
            {{#each headerMenu.items}}
              {{#if children.length}}
                <li class="sf-nav-item sf-nav-dropdown">
                  <button class="sf-nav-link sf-nav-dropdown-trigger" aria-expanded="false" aria-haspopup="true">
                    {{label}}
                    <svg class="sf-nav-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                  <ul class="sf-nav-dropdown-menu">
                    {{#each children}}
                      {{#if children.length}}
                        <li class="sf-nav-dropdown-item sf-has-submenu">
                          <button class="sf-nav-dropdown-link sf-submenu-trigger">
                            {{label}}
                            <svg class="sf-nav-chevron-right" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <polyline points="9 6 15 12 9 18"></polyline>
                            </svg>
                          </button>
                          <ul class="sf-nav-submenu">
                            {{#each children}}
                              <li>
                                <a href="{{url}}" class="sf-nav-submenu-link" {{#if openInNewTab}}target="_blank" rel="noopener noreferrer"{{/if}}>
                                  {{label}}
                                </a>
                              </li>
                            {{/each}}
                          </ul>
                        </li>
                      {{else}}
                        <li class="sf-nav-dropdown-item">
                          <a href="{{url}}" class="sf-nav-dropdown-link" {{#if openInNewTab}}target="_blank" rel="noopener noreferrer"{{/if}}>
                            {{label}}
                          </a>
                        </li>
                      {{/if}}
                    {{/each}}
                  </ul>
                </li>
              {{else}}
                <li class="sf-nav-item">
                  <a href="{{url}}" class="sf-nav-link" {{#if openInNewTab}}target="_blank" rel="noopener noreferrer"{{/if}}>
                    {{label}}
                  </a>
                </li>
              {{/if}}
            {{/each}}
          </ul>
        {{/if}}
      </nav>

      <!-- Header Actions -->
      <div class="sf-header-actions">
        <!-- Search Toggle -->
        <button class="sf-header-action-btn" aria-label="Pretraži" data-action="toggle-search">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.3-4.3"></path>
          </svg>
        </button>

        <!-- Notifications (logged in users only) -->
        {{#if user}}
          <button class="sf-header-action-btn sf-notification-trigger" aria-label="Obavijesti" data-action="notifications">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
              <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
            </svg>
          </button>
        {{/if}}

        <!-- Account -->
        {{#if user}}
          <div class="sf-header-user-menu">
            <button class="sf-header-action-btn sf-user-menu-trigger" aria-label="Korisnički izbornik" aria-expanded="false" aria-haspopup="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </button>
            <div class="sf-user-dropdown">
              <div class="sf-user-dropdown-inner">
                <div class="sf-user-dropdown-header">
                  <span class="sf-user-name">{{user.name}}</span>
                  <span class="sf-user-email">{{user.email}}</span>
                </div>
                <div class="sf-user-dropdown-links">
                  <a href="/admin/profile" class="sf-user-dropdown-link">Moj račun</a>
                  <a href="/admin/orders" class="sf-user-dropdown-link">Moje narudžbe</a>
                  <a href="/admin" class="sf-user-dropdown-link">Dashboard</a>
                  {{#if user.isSuperAdmin}}
                    <a href="/superadmin" class="sf-user-dropdown-link sf-user-admin-link">Super Admin</a>
                  {{/if}}
                </div>
                <div class="sf-user-dropdown-footer">
                  <a href="/auth/logout" class="sf-user-dropdown-link sf-user-logout">Odjava</a>
                </div>
              </div>
            </div>
          </div>
        {{else}}
          <a href="/auth/login" class="sf-header-action-btn" aria-label="Prijava">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </a>
        {{/if}}

        <!-- Cart -->
        <button class="sf-header-action-btn sf-cart-btn" aria-label="Košarica" data-action="open-cart">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
            <path d="M3 6h18"></path>
            <path d="M16 10a4 4 0 0 1-8 0"></path>
          </svg>
          <span class="sf-cart-count" data-cart-count style="display: none;">0</span>
        </button>

        <!-- Mobile Menu Toggle -->
        <button class="sf-header-menu-toggle" aria-label="Otvori izbornik" aria-expanded="false" data-action="toggle-mobile-menu">
          <svg class="sf-menu-icon-open" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="4" x2="20" y1="12" y2="12"></line>
            <line x1="4" x2="20" y1="6" y2="6"></line>
            <line x1="4" x2="20" y1="18" y2="18"></line>
          </svg>
          <svg class="sf-menu-icon-close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Search Overlay -->
  <div class="sf-search-overlay" data-search-overlay style="display: none;">
    <div class="sf-container">
      <form class="sf-search-form" action="/search" method="GET">
        <input 
          type="search" 
          name="q" 
          class="sf-search-input" 
          placeholder="Pretraži proizvode, članke..." 
          autocomplete="off"
          autofocus
        >
        <button type="submit" class="sf-btn sf-btn-primary">Pretraži</button>
        <button type="button" class="sf-search-close" data-action="close-search" aria-label="Zatvori pretragu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      </form>
    </div>
  </div>

  <!-- Mobile Menu - 3 levels supported -->
  <div class="sf-mobile-menu" data-mobile-menu style="display: none;">
    <div class="sf-mobile-menu-inner">
      {{#if headerMenu}}
        <nav class="sf-mobile-nav">
          <ul class="sf-mobile-nav-list">
            {{#each headerMenu.items}}
              <li class="sf-mobile-nav-item">
                {{#if children.length}}
                  <button class="sf-mobile-nav-link sf-mobile-toggle" data-toggle="submenu">
                    {{label}}
                    <svg class="sf-mobile-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                  <ul class="sf-mobile-nav-submenu" style="display: none;">
                    {{#each children}}
                      <li>
                        {{#if children.length}}
                          <button class="sf-mobile-nav-sublink sf-mobile-toggle" data-toggle="submenu">
                            {{label}}
                            <svg class="sf-mobile-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                          </button>
                          <ul class="sf-mobile-nav-level3" style="display: none;">
                            {{#each children}}
                              <li>
                                <a href="{{url}}" class="sf-mobile-nav-level3-link" {{#if openInNewTab}}target="_blank" rel="noopener noreferrer"{{/if}}>
                                  {{label}}
                                </a>
                              </li>
                            {{/each}}
                          </ul>
                        {{else}}
                          <a href="{{url}}" class="sf-mobile-nav-sublink" {{#if openInNewTab}}target="_blank" rel="noopener noreferrer"{{/if}}>
                            {{label}}
                          </a>
                        {{/if}}
                      </li>
                    {{/each}}
                  </ul>
                {{else}}
                  <a href="{{url}}" class="sf-mobile-nav-link" {{#if openInNewTab}}target="_blank" rel="noopener noreferrer"{{/if}}>
                    {{label}}
                  </a>
                {{/if}}
              </li>
            {{/each}}
          </ul>
        </nav>
      {{/if}}

      <div class="sf-mobile-menu-footer">
        {{#if user}}
          <a href="/account" class="sf-btn sf-btn-outline sf-w-full">Moj račun</a>
        {{else}}
          <a href="/auth/login" class="sf-btn sf-btn-primary sf-w-full">Prijava</a>
        {{/if}}
      </div>
    </div>
  </div>
</header>

<script>
// Mobile menu toggle
document.addEventListener('DOMContentLoaded', function() {
  // Mobile menu open/close
  const menuToggle = document.querySelector('[data-action="toggle-mobile-menu"]');
  const mobileMenu = document.querySelector('[data-mobile-menu]');
  const openIcon = document.querySelector('.sf-menu-icon-open');
  const closeIcon = document.querySelector('.sf-menu-icon-close');
  
  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener('click', function() {
      const isOpen = mobileMenu.style.display !== 'none';
      mobileMenu.style.display = isOpen ? 'none' : 'block';
      if (openIcon) openIcon.style.display = isOpen ? 'block' : 'none';
      if (closeIcon) closeIcon.style.display = isOpen ? 'none' : 'block';
      menuToggle.setAttribute('aria-expanded', !isOpen);
    });
  }
  
  // Mobile submenu toggles (3 levels)
  document.querySelectorAll('.sf-mobile-toggle').forEach(function(toggle) {
    toggle.addEventListener('click', function() {
      const submenu = this.nextElementSibling;
      if (submenu) {
        const isOpen = submenu.style.display !== 'none';
        submenu.style.display = isOpen ? 'none' : 'block';
        this.setAttribute('aria-expanded', !isOpen);
      }
    });
  });
  
  // Search overlay
  const searchToggle = document.querySelector('[data-action="toggle-search"]');
  const searchOverlay = document.querySelector('[data-search-overlay]');
  const searchClose = document.querySelector('[data-action="close-search"]');
  
  if (searchToggle && searchOverlay) {
    searchToggle.addEventListener('click', function() {
      searchOverlay.style.display = 'block';
      const input = searchOverlay.querySelector('input');
      if (input) input.focus();
    });
  }
  
  if (searchClose && searchOverlay) {
    searchClose.addEventListener('click', function() {
      searchOverlay.style.display = 'none';
    });
  }
});
</script>
